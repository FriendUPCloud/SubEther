<?php/*******************************************************************************
*   SubEther, The Decentralized Network.                                       *
*   Copyright (C) 2012 Friend Studios AS                                       *
*                                                                              *
*   This program is free software: you can redistribute it and/or modify       *
*   it under the terms of the GNU Affero General Public License as             *
*   published by the Free Software Foundation, either version 3 of the         *
*   License, or (at your option) any later version.                            *
*                                                                              *
*   This program is distributed in the hope that it will be useful,            *
*   but WITHOUT ANY WARRANTY; without even the implied warranty of             *
*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the              *
*   GNU Affero General Public License for more details.                        *
*                                                                              *
*   You should have received a copy of the GNU Affero General Public License   *
*   along with this program.  If not, see <https://www.gnu.org/licenses/>.     *
*******************************************************************************/global $database, $webuser;$admin = ( IsSystemAdmin() ? true : false );$q = '	SELECT 		c.*, u.DateLogin, u.DateCreated AS Joined 	FROM 		SBookContact c,		Users u	WHERE			c.ID = \'' . $parent->cuser->ContactID . '\'		AND u.ID = c.UserID ';$str = '';if( $row = $database->fetchObjectRow( $q ) ){	$row->Data = json_obj_decode( $row->Data );	$row->Custom = json_obj_decode( $row->Custom );		//die( print_r( $row->Custom,1 ) . ' --' );		if( ( $admin && $_REQUEST['edit'] ) || ( $parent->webuser->ID == $parent->cuser->UserID ) && ( isset( $_POST[ 'edit' ] ) || isset( $_REQUEST[ 'edit' ] ) ) )	{		$_REQUEST[ 'edit' ] = isset( $_REQUEST[ 'edit' ] ) ? explode( ',', $_REQUEST[ 'edit' ] ) : array();				$str .= '<table><tr><td><div id="AboutContent">';				// --- Work -------------------------------------------------------------------------------------------------				$str .= '<div id="WorkAndEducation">';				if( $_POST[ 'edit' ] == 'WorkAndEducation' )		{			$str = '';		}				$str .= '<div><h4>' . i18n( 'i18n_Work And Education' ) . '</h4><button class="closebtn" onclick="closeEdit( \'WorkAndEducation\' )"><span>' . i18n( 'i18n_Close' ) . '</span></button><button class="savebtn" onclick="saveAbout( \'WorkAndEducation\' )"><span>' . i18n( 'i18n_Save' ) . '</span></button></div>';		$str .= '<table>';				$str .= '<tr class="work"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Work' ) . ': </span></td><td><input name="Work" value="' . $row->Work . '"/><input name="Work_checked" type="checkbox" ' . ( $row->Data->Settings->Profile->Work > 0 ? 'checked="checked"' : '' ) . '/></td></tr>';		$str .= '<tr class="college"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_College' ) . ': </span></td><td><input name="College" value="' . $row->College . '"/><input name="College_checked" type="checkbox" ' . ( $row->Data->Settings->Profile->College > 0 ? 'checked="checked"' : '' ) . '/></td></tr>';		$str .= '<tr class="highschool"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_High School' ) . ': </span></td><td><input name="HighSchool" value="' . $row->HighSchool . '"/><input name="HighSchool_checked" type="checkbox" ' . ( $row->Data->Settings->Profile->HighSchool > 0 ? 'checked="checked"' : '' ) . '/></td></tr>';				$ii = 1;				if( isset( $row->Custom->About->Work ) && count( $row->Custom->About->Work ) > 0 )		{			foreach( $row->Custom->About->Work as $k=>$v )			{				if( is_object( $v ) && isset( $v->Label ) && isset( $v->Value ) )				{					$str .= '<tr><td>';										if( !$admin )					{						$str .= '<input type="hidden" name="Custom_Work_' . $ii . '_Label" value="' . $v->Label . '"/>';						$str .= '<span class="icon"></span><span class="label">' . i18n( 'i18n_' . $v->Label ) . ': </span>';					}					else					{						$str .= '<input name="Custom_Work_' . $ii . '_Label" value="' . $v->Label . '"/>: ';					}										$str .= '</td><td>';					$str .= '<input name="Custom_Work_' . $ii . '_Value" value="' . $v->Value . '"/>';					$str .= '</td></tr>';										$ii++;				}			}		}				$str .= !$admin ? '' : '<tr><td><input name="Custom_Work_' . $ii . '_Label"/>:</td><td><input name="Custom_Work_' . $ii . '_Value"/></td></tr>';				$str .= '</table>';				if( $_POST[ 'edit' ] == 'WorkAndEducation' )		{			die( 'ok<!--separate-->' . $str );		}				$str .= '</div>';				// --- Basic -------------------------------------------------------------------------------------------------				$str .= '<div id="Basic">';				if( $_POST[ 'edit' ] == 'Basic' )		{			$str = '';		}				$str .= '<div><h4>' . i18n( 'i18n_Basic Information' ) . '</h4><button class="closebtn" onclick="closeEdit( \'Basic\' )"><span>' . i18n( 'i18n_Close' ) . '</span></button><button class="savebtn" onclick="saveAbout( \'Basic\' )"><span>' . i18n( 'i18n_Save' ) . '</span></button></div>';		$str .= '<table>';		$str .= '<tr class="firstname"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Firstname' ) . ': </span></td><td><input name="Firstname" value="' . $row->Firstname . '"/></td></tr>';		$str .= '<tr class="middlename"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Middlename' ) . ': </span></td><td><input name="Middlename" value="' . $row->Middlename . '"/></td></tr>';		$str .= '<tr class="lastname"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Lastname' ) . ': </span></td><td><input name="Lastname" value="' . $row->Lastname . '"/></td></tr>';				$str .= '<tr class="display"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Display as' ) . ': </span></td>';		$str .= '<td><select id="Display" name="Display">';		$first = $row->Firstname ? ( $row->Firstname . ' ' ) : '';		$middle = $row->Middlename ? ( $row->Middlename . ' ' ) : '';		$last = $row->Lastname ? ( $row->Lastname . ' ' ) : '';		$str .= '<option value="0" ' . ( $row->Display == '0' ? 'selected="selected"' : '' ) . '>' . $row->Username . '</option>';		$str .= '<option value="1" ' . ( $row->Display == '1' ? 'selected="selected"' : '' ) . '>' . trim( $first . $middle . $last ) . '</option>';		$str .= '<option value="2" ' . ( $row->Display == '2' ? 'selected="selected"' : '' ) . '>' . trim( $first . $last ) . '</option>';		$str .= '<option value="3" ' . ( $row->Display == '3' ? 'selected="selected"' : '' ) . '>' . trim( $last . $first ) . '</option>';		$str .= '</select></td><tr>';				$str .= '<tr class="birthdate"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Birthdate' ) . ': </span></td><td>';				$str .= '<select id="Bday" onchange="SetBirthday()">';		for( $d = 1; $d <= 31; $d++ )		{			$s = ( ( $row->Birthdate && date( 'j', strtotime( $row->Birthdate ) ) == $d ) ? true : false );			$str .= '<option value="' . date( 'd', strtotime( date( 'Y' ) . '-01-' . $d ) ) . '"' . ( $s ? ' selected="selected"' : '' ) . '>' . date( 'j', strtotime( date( 'Y' ) . '-01-' . $d ) ) . '</option>';		}		$str .= '</select>';				$str .= '<select id="Bmonth" onchange="SetBirthday()">';		for( $m = 1; $m <= 12; $m++ )		{			$s = ( ( $row->Birthdate && date( 'n', strtotime( $row->Birthdate ) ) == $m ) ? true : false );			$str .= '<option value="' . date( 'm', strtotime( date( 'Y' ) . '-' . $m . '-01' ) ) . '"' . ( $s ? ' selected="selected"' : '' ) . '>' . i18n( 'i18n_' . date( 'F', strtotime( date( 'Y' ) . '-' . $m . '-01' ) ) ) . '</option>';		}		$str .= '</select>';				$str .= '<select id="Byear" onchange="SetBirthday()">';		for( $y = date( 'Y' ); $y >= 1900; $y-- )		{			$s = ( ( $row->Birthdate && date( 'Y', strtotime( $row->Birthdate ) ) == $y ) ? true : false );			$str .= '<option value="' . $y . '"' . ( $s ? ' selected="selected"' : '' ) . '>' . $y . '</option>';		}		$str .= '</select>';				$str .= '<input type="hidden" id="Birthdate" name="Birthdate" value="' . $row->Birthdate . '"/>';				$str .= '</td></tr>';				$str .= '<tr class="gender"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Gender' ) . ': </span></td><td><input name="Gender" value="' . $row->Gender . '"/><input name="Gender_checked" type="checkbox" ' . ( $row->Data->Settings->Profile->Gender > 0 ? 'checked="checked"' : '' ) . '/></td></tr>';		$str .= '<tr class="languages"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Languages' ) . ': </span></td><td><input name="Languages" value="' . $row->Languages . '"/><input name="Languages_checked" type="checkbox" ' . ( $row->Data->Settings->Profile->Languages > 0 ? 'checked="checked"' : '' ) . '/></td></tr>';		$str .= '<tr class="interests"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Interests' ) . ': </span></td><td><input name="Interests" value="' . $row->Interests . '"/><input name="Interests_checked" type="checkbox" ' . ( $row->Data->Settings->Profile->Interests > 0 ? 'checked="checked"' : '' ) . '/></td></tr>';		$str .= '<tr class="philosophy"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Philosophy' ) . ': </span></td><td><input name="Philosophy" value="' . $row->Philosophy . '"/><input name="Philosophy_checked" type="checkbox" ' . ( $row->Data->Settings->Profile->Philosophy > 0 ? 'checked="checked"' : '' ) . '/></td></tr>';		$str .= '<tr class="religious"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Religious view' ) . ': </span></td><td><input name="Religion" value="' . $row->Religion . '"/><input name="Religion_checked" type="checkbox" ' . ( $row->Data->Settings->Profile->Religion > 0 ? 'checked="checked"' : '' ) . '/></td></tr>';		$str .= '<tr class="political"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Political view' ) . ': </span></td><td><input name="Political" value="' . $row->Political . '"/><input name="Political_checked" type="checkbox" ' . ( $row->Data->Settings->Profile->Political > 0 ? 'checked="checked"' : '' ) . '/></td></tr>';				$ii = 1;				if( isset( $row->Custom->About->Basic ) && count( $row->Custom->About->Basic ) > 0 )		{			foreach( $row->Custom->About->Basic as $k=>$v )			{				if( is_object( $v ) && isset( $v->Label ) && isset( $v->Value ) )				{					$str .= '<tr><td>';										if( !$admin )					{						$str .= '<input type="hidden" name="Custom_Basic_' . $ii . '_Label" value="' . $v->Label . '"/>';						$str .= '<span class="icon"></span><span class="label">' . i18n( 'i18n_' . $v->Label ) . ': </span>';					}					else					{						$str .= '<input name="Custom_Basic_' . $ii . '_Label" value="' . $v->Label . '"/>: ';					}										$str .= '</td><td>';					$str .= '<input name="Custom_Basic_' . $ii . '_Value" value="' . $v->Value . '"/>';					$str .= '</td></tr>';										$ii++;				}			}		}				$str .= !$admin ? '' : '<tr><td><input name="Custom_Basic_' . $ii . '_Label"/>:</td><td><input name="Custom_Basic_' . $ii . '_Value"/></td></tr>';				$str .= '</table>';				if( $_POST[ 'edit' ] == 'Basic' )		{			die( 'ok<!--separate-->' . $str );		}				$str .= '</div>';				// --- Contact ------------------------------------------------------------------------------------------------------				$str .= '<div id="ContactInfo">';				if( $_POST[ 'edit' ] == 'ContactInfo' )		{			$str = '';		}				$str .= '<div><h4>' . i18n( 'i18n_Contact Information' ) . '</h4><button class="closebtn" onclick="closeEdit( \'ContactInfo\' )"><span>' . i18n( 'i18n_Close' ) . '</span></button><button class="savebtn" onclick="saveAbout( \'ContactInfo\' )"><span>' . i18n( 'i18n_Save' ) . '</span></button></div>';		$str .= '<table>';		$str .= '<tr class="email"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Email' ) . ': </span></td><td><input name="Email" value="' . $row->Email . '"/><input name="Email_checked" type="checkbox" ' . ( $row->Data->Settings->Profile->Email > 0 ? 'checked="checked"' : '' ) . '/></td></tr>';		$str .= '<tr class="mobile"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Mobile' ) . ': </span></td><td><input name="Mobile" value="' . $row->Mobile . '"/><input name="Mobile_checked" type="checkbox" ' . ( $row->Data->Settings->Profile->Mobile > 0 ? 'checked="checked"' : '' ) . '/></td></tr>';		$str .= '<tr class="address"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Address' ) . ': </span></td><td><input name="Address" value="' . $row->Address . '"/><input name="Address_checked" type="checkbox" ' . ( $row->Data->Settings->Profile->Address > 0 ? 'checked="checked"' : '' ) . '/></td></tr>';		$str .= '<tr class="screenname"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Screen Name' ) . ': </span></td><td><input name="ScreenName" value="' . $row->ScreenName . '"/><input name="ScreenName_checked" type="checkbox" ' . ( $row->Data->Settings->Profile->ScreenName > 0 ? 'checked="checked"' : '' ) . '/></td></tr>';		$str .= '<tr class="website"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Website' ) . ': </span></td><td><input name="Website" value="' . $row->Website . '"/><input name="Website_checked" type="checkbox" ' . ( $row->Data->Settings->Profile->Website > 0 ? 'checked="checked"' : '' ) . '/></td></tr>';				$ii = 1;				if( isset( $row->Custom->About->Contact ) && count( $row->Custom->About->Contact ) > 0 )		{			foreach( $row->Custom->About->Contact as $k=>$v )			{				if( is_object( $v ) && isset( $v->Label ) && isset( $v->Value ) )				{					$str .= '<tr><td>';										if( !$admin )					{						$str .= '<input type="hidden" name="Custom_Contact_' . $ii . '_Label" value="' . $v->Label . '"/>';						$str .= '<span class="icon"></span><span class="label">' . i18n( 'i18n_' . $v->Label ) . ': </span>';					}					else					{						$str .= '<input name="Custom_Contact_' . $ii . '_Label" value="' . $v->Label . '"/>: ';					}										$str .= '</td><td>';					$str .= '<input name="Custom_Contact_' . $ii . '_Value" value="' . $v->Value . '"/>';					$str .= '</td></tr>';										$ii++;				}			}		}				$str .= !$admin ? '' : '<tr><td><input name="Custom_Contact_' . $ii . '_Label"/>:</td><td><input name="Custom_Contact_' . $ii . '_Value"/></td></tr>';				$str .= '</table>';				if( $_POST[ 'edit' ] == 'ContactInfo' )		{			die( 'ok<!--separate-->' . $str );		}				$str .= '</div>';				// --- Extended ------------------------------------------------------------------------------------------------------				if( $admin || ( isset( $row->Custom->About->Extended ) && count( $row->Custom->About->Extended ) > 0 ) )		{			$str .= '<div id="ExtendedInfo">';						if( $_POST[ 'edit' ] == 'ExtendedInfo' )			{				$str = '';			}						$str .= '<div><h4>' . i18n( 'i18n_Extended Information' ) . '</h4><button class="closebtn" onclick="closeEdit( \'ExtendedInfo\' )"><span>' . i18n( 'i18n_Close' ) . '</span></button><button class="savebtn" onclick="saveAbout( \'ExtendedInfo\' )"><span>' . i18n( 'i18n_Save' ) . '</span></button></div>';			$str .= '<table>';						$ii = 1;						if( isset( $row->Custom->About->Extended ) && count( $row->Custom->About->Extended ) > 0 )			{				foreach( $row->Custom->About->Extended as $k=>$v )				{					if( is_object( $v ) && isset( $v->Label ) && isset( $v->Value ) )					{						$str .= '<tr><td>';												if( !$admin )						{							$str .= '<input type="hidden" name="Custom_Extended_' . $ii . '_Label" value="' . $v->Label . '"/>';							$str .= '<span class="icon"></span><span class="label">' . i18n( 'i18n_' . $v->Label ) . ': </span>';						}						else						{							$str .= '<input name="Custom_Extended_' . $ii . '_Label" value="' . $v->Label . '"/>: ';						}												$str .= '</td><td>';						$str .= '<input name="Custom_Extended_' . $ii . '_Value" value="' . $v->Value . '"/>';						$str .= '</td></tr>';												$ii++;					}				}			}						$str .= !$admin ? '' : '<tr><td><input name="Custom_Extended_' . $ii . '_Label"/>:</td><td><input name="Custom_Extended_' . $ii . '_Value"/></td></tr>';						$str .= '</table>';						if( $_POST[ 'edit' ] == 'ExtendedInfo' )			{				die( 'ok<!--separate-->' . $str );			}						$str .= '</div>';		}				// --- About ---------------------------------------------------------------------------------------------------------				$str .= '<div id="AboutMe">';				if( $_POST[ 'edit' ] == 'AboutMe' )		{			$str = '';		}				$str .= '<div><h4>' . i18n( 'i18n_About' ) . '</h4><button class="closebtn" onclick="closeEdit( \'AboutMe\' )"><span>' . i18n( 'i18n_Close' ) . '</span></button><button class="savebtn" onclick="saveAbout( \'AboutMe\' )"><span>' . i18n( 'i18n_Save' ) . '</span></button></div>';		$str .= '<table>';		$str .= '<tr class="about"><td colspan="2"><textarea name="About">' . $row->About . '</textarea></td></tr>';				$ii = 1;				if( isset( $row->Custom->About->About ) && count( $row->Custom->About->About ) > 0 )		{			foreach( $row->Custom->About->About as $k=>$v )			{				if( is_object( $v ) && isset( $v->Label ) && isset( $v->Value ) )				{					$str .= '<tr><td>';										if( !$admin )					{						$str .= '<input type="hidden" name="Custom_About_' . $ii . '_Label" value="' . $v->Label . '"/>';						$str .= '<span class="icon"></span><span class="label">' . i18n( 'i18n_' . $v->Label ) . ': </span>';					}					else					{						$str .= '<input name="Custom_About_' . $ii . '_Label" value="' . $v->Label . '"/>: ';					}										$str .= '</td><td>';					$str .= '<input name="Custom_About_' . $ii . '_Value" value="' . $v->Value . '"/>';					$str .= '</td></tr>';										$ii++;				}			}		}				$str .= !$admin ? '' : '<tr><td><input name="Custom_About_' . $ii . '_Label"/>:</td><td><input name="Custom_About_' . $ii . '_Value"/></td></tr>';				$str .= '</table>';				if( $_POST[ 'edit' ] == 'AboutMe' )		{			die( 'ok<!--separate-->' . $str );		}				$str .= '</div>';				// --- Quotations ---------------------------------------------------------------------------------------------				$str .= '<div id="Quotations">';				if( $_POST[ 'edit' ] == 'Quotations' )		{			$str = '';		}				$str .= '<div><h4>' . i18n( 'i18n_Quotations' ) . '</h4><button class="closebtn" onclick="closeEdit( \'Quotations\' )"><span>' . i18n( 'i18n_Close' ) . '</span></button><button class="savebtn" onclick="saveAbout( \'Quotations\' )"><span>' . i18n( 'i18n_Save' ) . '</span></button></div>';		$str .= '<table>';		$str .= '<tr class="quotations"><td colspan="2"><textarea name="Quotations">' . $row->Quotations . '</textarea></td></tr>';				$ii = 1;				if( isset( $row->Custom->About->Quotations ) && count( $row->Custom->About->Quotations ) > 0 )		{			foreach( $row->Custom->About->Quotations as $k=>$v )			{				if( is_object( $v ) && isset( $v->Label ) && isset( $v->Value ) )				{					$str .= '<tr><td>';										if( !$admin )					{						$str .= '<input type="hidden" name="Custom_Quotations_' . $ii . '_Label" value="' . $v->Label . '"/>';						$str .= '<span class="icon"></span><span class="label">' . i18n( 'i18n_' . $v->Label ) . ': </span>';					}					else					{						$str .= '<input name="Custom_Quotations_' . $ii . '_Label" value="' . $v->Label . '"/>: ';					}										$str .= '</td><td>';					$str .= '<input name="Custom_Quotations_' . $ii . '_Value" value="' . $v->Value . '"/>';					$str .= '</td></tr>';										$ii++;				}			}		}				$str .= !$admin ? '' : '<tr><td><input name="Custom_Quotations_' . $ii . '_Label"/>:</td><td><input name="Custom_Quotations_' . $ii . '_Value"/></td></tr>';				$str .= '</table>';				if( $_POST[ 'edit' ] == 'Quotations' )		{			die( 'ok<!--separate-->' . $str );		}				$str .= '</div>';				$str .= '</div></td><td>';				$str .= '</td></tr></table>';	}	else	{		$str .= '<table><tr><td><div id="AboutContent">';				// --- Statistics -------------------------------------------------------------------------------------------------------		if ( $settings = $database->fetchObjectRows ( '			SELECT * 			FROM SBookSettings 			ORDER BY ID ASC 		' ) )		{			$str .= '<div id="Statistics">';						$str .= '<div><h4>' . i18n( 'i18n_Statistics' ) . '</h4>';						$str .= '</div><table>';						$str .= ''; $next = false; $out = [];						$online = IsUserOnline( $parent->cuser->UserID );						$posts = $database->fetchObjectRow ( '				SELECT SUM(Counter) AS Counter 				FROM SBookStats 				WHERE SenderID = \'' . $parent->cuser->ContactID . '\' 				AND Component = "wall"				AND Type = "post"				AND Action = "save" 				ORDER BY Counter DESC 			' );						$likes = $database->fetchObjectRow ( '				SELECT SUM(Counter) AS Counter 				FROM SBookStats 				WHERE ReceiverID = \'' . $parent->cuser->ContactID . '\' 				AND Component = "wall"				AND Action = "like" 				ORDER BY Counter DESC 			' );						//die( print_r( $posts,1 ) . ' --' );			foreach( $settings as $set )			{				if( !isset( $out[$set->Component] ) && $set->Counter <= $posts->Counter )				{					$set->Progress = $posts->Counter;										$out[$set->Component] = $set;				}				else if( isset( $out[$set->Component] ) && !$next )				{					$next = $set->Counter;				}			}						$str .= '<tr class="joined"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Joined' ) . ': </span></td><td><span class="name">' . date( 'F j, Y', strtotime( $row->Joined ) ) . '</span></td></tr>';			$str .= '<tr class="status"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Status' ) . ': </span></td><td><span class="name">' . ( isset( $online->LastActivity ) && ( date( 'YmdHi' ) - date( 'YmdHi', strtotime( $online->LastActivity ) ) ) <= 10 ? 'Online' : 'Offline (Last Online ' . TimeToHuman( isset( $online->LastActivity ) ? $online->LastActivity : $row->DateLogin ) . ')' ) . '</span></td></tr>';						if( $out )			{				foreach( $out as $o )				{					$str .= '<tr class="rank"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Rank' ) . ': </span></td><td><span class="name">' . $o->Name . ( $next && $o->Progress ? ' (' . $o->Progress . ' of ' . $next . ')' : '' ) . '</span></td></tr>';				}			}						if( isset( $posts->Counter ) )			{				$str .= '<tr class="posts"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Posts' ) . ': </span></td><td><span class="name">' . $posts->Counter . '</span></td></tr>';			}						if( isset( $likes->Counter ) )			{				$str .= '<tr class="likes"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Likes' ) . ': </span></td><td><span class="name">' . $likes->Counter . '</span></td></tr>';			}						$str .= '</table>';						$str .= '</div>';		}				// --- Work -------------------------------------------------------------------------------------------------------				$str .= '<div id="WorkAndEducation">';				if( $_POST[ 'refresh' ] == 'WorkAndEducation' )		{			$str = '';		}				if( $admin || ( $parent->cuser->UserID == $webuser->ID ) || $row->Work || $row->College || $row->HighSchool || ( isset( $row->Custom->About->Work ) && count( $row->Custom->About->Work ) > 0 ) )		{			$str .= '<div><h4>' . i18n( 'i18n_Work And Education' ) . '</h4>';		}		else		{			$str .= '<div>';		}				if( $admin || ( $parent->cuser->UserID == $webuser->ID ) )		{			$str .= '<button class="editbtn" onclick="editAbout( \'WorkAndEducation\' )"><span>' . i18n( 'i18n_Edit' ) . '</span></button>';		}				$str .= '</div><table>';		$str .= !$row->Work ? '' : '<tr class="work"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Work' ) . ': </span></td><td><span class="name">' . $row->Work . '</span></td></tr>';		$str .= !$row->College ? '' : '<tr class="college"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_College' ) . ': </span></td><td><span class="name">' . $row->College . '</span></td></tr>';		$str .= !$row->HighSchool ? '' : '<tr class="highschool"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_High School' ) . ': </span></td><td><span class="name">' . $row->HighSchool . '</span></td></tr>';				if( isset( $row->Custom->About->Work ) && count( $row->Custom->About->Work ) > 0 )		{			foreach( $row->Custom->About->Work as $k=>$v )			{				if( is_object( $v ) && isset( $v->Label ) && $v->Value )				{					$str .= '<tr><td><span class="icon"></span><span class="label">' . i18n( 'i18n_' . $v->Label ) . ': </span></td><td><span class="name">' . $v->Value . '</span></td></tr>';				}			}		}				$str .= '</table>';				if( $_POST[ 'refresh' ] == 'WorkAndEducation' )		{			die( 'ok<!--separate-->' . $str );		}				$str .= '</div>';				// --- Basic ------------------------------------------------------------------------------------------------------				$str .= '<div id="Basic">';				if( $_POST[ 'refresh' ] == 'Basic' )		{			$str = '';		}				if( $admin || ( $parent->cuser->UserID == $webuser->ID ) || $row->Firstname || $row->Middlename || $row->Lastname || $row->Birthdate || $row->Gender || $row->Languages || $row->Interests || $row->Philosophy || $row->Religion || $row->Political || ( isset( $row->Custom->About->Basic ) && count( $row->Custom->About->Basic ) > 0 ) )		{			$str .= '<div><h4>' . i18n( 'i18n_Basic Information' ) . '</h4>';		}		else		{			$str .= '<div>';		}				if( $admin || ( $parent->cuser->UserID == $webuser->ID ) )		{			$str .= '<button class="editbtn" onclick="editAbout( \'Basic\' )"><span>' . i18n( 'i18n_Edit' ) . '</span></button>';		}				$str .= '</div><table>';		$str .= !$row->Firstname ? '' : '<tr class="firstname"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Firstname' ) . ': </span></td><td><span class="name">' . $row->Firstname . '</span></td></tr>';		$str .= !$row->Middlename ? '' : '<tr class="middlename"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Middlename' ) . ': </span></td><td><span class="name">' . $row->Middlename . '</span></td></tr>';		$str .= !$row->Lastname ? '' : '<tr class="lastname"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Lastname' ) . ': </span></td><td><span class="name">' . $row->Lastname . '</span></td></tr>';		$str .= !$row->Birthdate ? '' : '<tr class="birthdate"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Birthdate' ) . ': </span></td><td><span class="name">' . i18n( 'i18n_'.date( 'j', strtotime( $row->Birthdate ) ) ) . ' ' . i18n( 'i18n_'.date( 'F', strtotime( $row->Birthdate ) ) ) . ' ' . i18n( 'i18n_'.date( 'Y', strtotime( $row->Birthdate ) ) ) . '</span></td></tr>';		$str .= !$row->Gender ? '' : '<tr class="gender"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Gender' ) . ': </span></td><td><span class="name">' . $row->Gender . '</span></td></tr>';		$str .= !$row->Languages ? '' : '<tr class="languages"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Languages' ) . ': </span></td><td><span class="name">' . $row->Languages . '</span></td></tr>';		$str .= !$row->Interests ? '' : '<tr class="interests"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Interests' ) . ': </span></td><td><span class="name">' . $row->Interests . '</span></td></tr>';		$str .= !$row->Philosophy ? '' : '<tr class="philosophy"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Philosophy' ) . ': </span></td><td><span class="name">' . $row->Philosophy . '</span></td></tr>';		$str .= !$row->Religion ? '' : '<tr class="religious"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Religious view' ) . ': </span></td><td><span class="name">' . $row->Religion . '</span></td></tr>';		$str .= !$row->Political ? '' : '<tr class="political"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Political view' ) . ': </span></td><td><span class="name">' . $row->Political . '</span></td></tr>';				if( isset( $row->Custom->About->Basic ) && count( $row->Custom->About->Basic ) > 0 )		{			foreach( $row->Custom->About->Basic as $k=>$v )			{				if( is_object( $v ) && isset( $v->Label ) && $v->Value )				{					$str .= '<tr><td><span class="icon"></span><span class="label">' . i18n( 'i18n_' . $v->Label ) . ': </span></td><td><span class="name">' . $v->Value . '</span></td></tr>';				}			}		}				$str .= '</table>';				if( $_POST[ 'refresh' ] == 'Basic' )		{			die( 'ok<!--separate-->' . $str );		}				$str .= '</div>';				// --- Contact --------------------------------------------------------------------------------------------------				$str .= '<div id="ContactInfo">';				if( $_POST[ 'refresh' ] == 'ContactInfo' )		{			$str = '';		}				if( $admin || ( $parent->cuser->UserID == $webuser->ID ) || $row->Email || $row->Mobile || $row->Address || $row->ScreenName || $row->Website || ( isset( $row->Custom->About->Contact ) && count( $row->Custom->About->Contact ) > 0 ) )		{			$str .= '<div><h4>' . i18n( 'i18n_Contact Information' ) . '</h4>';		}		else		{			$str .= '<div>';		}				if( $admin || ( $parent->cuser->UserID == $webuser->ID ) )		{			$str .= '<button class="editbtn" onclick="editAbout( \'ContactInfo\' )"><span>' . i18n( 'i18n_Edit' ) . '</span></button>';		}				$str .= '</div><table>';		$str .= !$row->Email ? '' : '<tr class="email"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Email' ) . ': </span></td><td><span class="name">' . $row->Email . '</span></td></tr>';		$str .= !$row->Mobile ? '' : '<tr class="mobile"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Mobile' ) . ': </span></td><td><span class="name">' . $row->Mobile . '</span></td></tr>';		$str .= !$row->Address ? '' : '<tr class="address"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Address' ) . ': </span></td><td><span class="name">' . $row->Address . '</span></td></tr>';		$str .= !$row->ScreenName ? '' : '<tr class="screenname"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Screen Name' ) . ': </span></td><td><span class="name">' . $row->ScreenName . '</span></td></tr>';		$str .= !$row->Website ? '' : '<tr class="website"><td><span class="icon"></span><span class="label">' . i18n( 'i18n_Website' ) . ': </span></td><td><span class="name">' . $row->Website . '</span></td></tr>';				if( isset( $row->Custom->About->Contact ) && count( $row->Custom->About->Contact ) > 0 )		{			foreach( $row->Custom->About->Contact as $k=>$v )			{				if( is_object( $v ) && isset( $v->Label ) && $v->Value )				{					$str .= '<tr><td><span class="icon"></span><span class="label">' . i18n( 'i18n_' . $v->Label ) . ': </span></td><td><span class="name">' . $v->Value . '</span></td></tr>';				}			}		}				$str .= '</table>';				if( $_POST[ 'refresh' ] == 'ContactInfo' )		{			die( 'ok<!--separate-->' . $str );		}				$str .= '</div>';				// --- Extended --------------------------------------------------------------------------------------------------				if ( $admin || ( isset( $row->Custom->About->Extended ) && count( $row->Custom->About->Extended ) > 0 ) )		{			$str .= '<div id="ExtendedInfo">';						if( $_POST[ 'refresh' ] == 'ExtendedInfo' )			{				$str = '';			}						if( $admin || ( $parent->cuser->UserID == $webuser->ID ) || ( isset( $row->Custom->About->Extended ) && count( $row->Custom->About->Extended ) > 0 ) )			{				$str .= '<div><h4>' . i18n( 'i18n_Extended Information' ) . '</h4>';			}			else			{				$str .= '<div>';			}						if( $admin || ( $parent->cuser->UserID == $webuser->ID ) )			{				$str .= '<button class="editbtn" onclick="editAbout( \'ExtendedInfo\' )"><span>' . i18n( 'i18n_Edit' ) . '</span></button>';			}						$str .= '</div><table>';						if( isset( $row->Custom->About->Extended ) && count( $row->Custom->About->Extended ) > 0 )			{				foreach( $row->Custom->About->Extended as $k=>$v )				{					if( is_object( $v ) && isset( $v->Label ) && $v->Value )					{						$str .= '<tr><td><span class="icon"></span><span class="label">' . i18n( 'i18n_' . $v->Label ) . ': </span></td><td><span class="name">' . $v->Value . '</span></td></tr>';					}				}			}			else			{				$str .= '<tr><td><div></div></td></tr>';			}						$str .= '</table>';						if( $_POST[ 'refresh' ] == 'ExtendedInfo' )			{				die( 'ok<!--separate-->' . $str );			}						$str .= '</div>';		}				// --- About ----------------------------------------------------------------------------------------------------				$str .= '<div id="AboutMe">';				if( $_POST[ 'refresh' ] == 'AboutMe' )		{			$str = '';		}				if( $admin || ( $parent->cuser->UserID == $webuser->ID ) || $row->About || ( isset( $row->Custom->About->About ) && count( $row->Custom->About->About ) > 0 ) )		{			$str .= '<div><h4>' . i18n( 'i18n_About' ) . '</h4>';		}		else		{			$str .= '<div>';		}				if( $admin || ( $parent->cuser->UserID == $webuser->ID ) )		{			$str .= '<button class="editbtn" onclick="editAbout( \'AboutMe\' )"><span>' . i18n( 'i18n_Edit' ) . '</span></button>';		}				$str .= '</div><table>';		$str .= !$row->About ? '' : '<tr class="about"><td><div>' . nl2br( $row->About ) . '</div></td></tr>';				if( isset( $row->Custom->About->About ) && count( $row->Custom->About->About ) > 0 )		{			foreach( $row->Custom->About->About as $k=>$v )			{				if( is_object( $v ) && isset( $v->Label ) && $v->Value )				{					$str .= '<tr><td><span class="icon"></span><span class="label">' . i18n( 'i18n_' . $v->Label ) . ': </span></td><td><span class="name">' . $v->Value . '</span></td></tr>';				}			}		}		else		{			$str .= '<tr><td><div></div></td></tr>';		}				$str .= '</table>';				if( $_POST[ 'refresh' ] == 'AboutMe' )		{			die( 'ok<!--separate-->' . $str );		}				$str .= '</div>';				// --- Quotations ------------------------------------------------------------------------------------------------				$str .= '<div id="Quotations">';				if( $_POST[ 'refresh' ] == 'Quotations' )		{			$str = '';		}				if( $admin || ( $parent->cuser->UserID == $webuser->ID ) || $row->Quotations || ( isset( $row->Custom->About->Quotations ) && count( $row->Custom->About->Quotations ) > 0 ) )		{			$str .= '<div><h4>' . i18n( 'i18n_Quotations' ) . '</h4>';		}		else		{			$str .= '<div>';		}				if( $admin || ( $parent->cuser->UserID == $webuser->ID ) )		{			$str .= '<button class="editbtn" onclick="editAbout( \'Quotations\' )"><span>' . i18n( 'i18n_Edit' ) . '</span></button>';		}				$str .= '</div><table>';		$str .= !$row->Quotations ? '' : '<tr class="quotations"><td><div>' . nl2br( $row->Quotations ) . '</div></td></tr>';				if( isset( $row->Custom->About->Quotations ) && count( $row->Custom->About->Quotations ) > 0 )		{			foreach( $row->Custom->About->Quotations as $k=>$v )			{				if( is_object( $v ) && isset( $v->Label ) && $v->Value )				{					$str .= '<tr><td><span class="icon"></span><span class="label">' . i18n( 'i18n_' . $v->Label ) . ': </span></td><td><span class="name">' . $v->Value . '</span></td></tr>';				}			}		}		else		{			$str .= '<tr><td><div></div></td></tr>';		}				$str .= '</table>';				if( $_POST[ 'refresh' ] == 'Quotations' )		{			die( 'ok<!--separate-->' . $str );		}				$str .= '</div>';				$str .= '</div></td><td>';				$str .= '</td></tr></table>';	}}?>