<?php/*******************************************************************************
*   SubEther, The Decentralized Network.                                       *
*   Copyright (C) 2012 Friend Studios AS                                       *
*                                                                              *
*   This program is free software: you can redistribute it and/or modify       *
*   it under the terms of the GNU Affero General Public License as             *
*   published by the Free Software Foundation, either version 3 of the         *
*   License, or (at your option) any later version.                            *
*                                                                              *
*   This program is distributed in the hope that it will be useful,            *
*   but WITHOUT ANY WARRANTY; without even the implied warranty of             *
*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the              *
*   GNU Affero General Public License for more details.                        *
*                                                                              *
*   You should have received a copy of the GNU Affero General Public License   *
*   along with this program.  If not, see <https://www.gnu.org/licenses/>.     *
*******************************************************************************/global $database, $webuser;$year = new CalendarYear( date( 'Y-m-d H:i:s' ) );$collect = array();/* --- testing --- */$test = new stdClass();$test->Date = '2014-01-01';$test->Group = 'NTO INCOME';$test->Label = 'Per';$test->Sum = 18000;$collect[] = $test;$test2 = new stdClass();$test2->Date = '2014-02-01';$test2->Group = 'NTO INCOME';$test2->Label = 'Per';$test2->Sum = 18000;$collect[] = $test2;$test3 = new stdClass();$test3->Date = '2014-03-01';$test3->Group = 'NTO INCOME';$test3->Label = 'Per';$test3->Sum = 20000;$collect[] = $test3;$test4 = new stdClass();$test4->Date = '2014-04-01';$test4->Group = 'NTO INCOME';$test4->Label = 'Per';$test4->Sum = 20000;$collect[] = $test4;$test5 = new stdClass();$test5->Date = '2014-01-01';$test5->Group = 'NTO INCOME';$test5->Label = 'P책l';$test5->Sum = 1000;$collect[] = $test5;$test6 = new stdClass();$test6->Date = '2014-02-01';$test6->Group = 'NTO INCOME';$test6->Label = 'P책l';$test6->Sum = 1000;$collect[] = $test6;$test7 = new stdClass();$test7->Date = '2014-03-01';$test7->Group = 'NTO INCOME';$test7->Label = 'P책l';$test7->Sum = 2000;$collect[] = $test7;$test8 = new stdClass();$test8->Date = '2014-04-01';$test8->Group = 'NTO INCOME';$test8->Label = 'P책l';$test8->Sum = 2000;$collect[] = $test8;/* --- --- */$test9 = new stdClass();$test9->Date = '2014-01-01';$test9->Group = 'BILLS';$test9->Label = 'RENT';$test9->Sum = 5000;$collect[] = $test9;$test10 = new stdClass();$test10->Date = '2014-02-01';$test10->Group = 'BILLS';$test10->Label = 'RENT';$test10->Sum = 5000;$collect[] = $test10;$test11 = new stdClass();$test11->Date = '2014-03-01';$test11->Group = 'BILLS';$test11->Label = 'RENT';$test11->Sum = 5000;$collect[] = $test11;$test12 = new stdClass();$test12->Date = '2014-04-01';$test12->Group = 'BILLS';$test12->Label = 'RENT';$test12->Sum = 5500;$collect[] = $test12;/* --- testing --- */$year->ImportMultipleData( $collect, 'Date', 'Date', 'month' );if( $year->months ){	$s = new stdClass();	$head = array(); $sum = array(); $content = array();	foreach( $year->months as $month )	{		$month->month = str_pad( $month->month, 2, 0, STR_PAD_LEFT );		$content[0] = '';		$head['head']['00'] = '';		$head['head'][$month->month] = strLimit( $month->name, 3 );		$head['head'][str_pad( ( $month->month+1 ), 2, 0, STR_PAD_LEFT )] = 'Sum';		$head['head'][str_pad( ( $month->month+2 ), 2, 0, STR_PAD_LEFT )] = '%';		if( $month->data )		{			foreach( $month->data as $k=>$data )			{				$month->data['Sum'][$data->Group] = ( $data->Sum + $month->data['Sum'][$data->Group] );								$content[$data->Group][$data->Label]['00'] = $data->Label;				$content[$data->Group][$data->Label][$month->month] = $data->Sum;								$sum[$data->Group]['Sum']['00'] = 'Sum';				$sum[$data->Group]['Sum'][$month->month] = $month->data['Sum'][$data->Group];			}		}		if( $content )		{			foreach( $content as $grp=>$lbs )			{				if( $lbs )				{					if( !$sum[$grp]['Sum'][$month->month] )					{						$sum[$grp]['Sum'][$month->month] = 0;					}					if( $month->month == 12 )					{						$content[$grp]['Sum'] = $sum[$grp]['Sum'];						$content[$grp]['Sum'][str_pad( ( $month->month+1 ), 2, 0, STR_PAD_LEFT )] = ( $total = CalcSumFromArray( $sum[$grp]['Sum'] ) );						$content[$grp]['Sum'][str_pad( ( $month->month+2 ), 2, 0, STR_PAD_LEFT )] = '100%';					}					foreach( $lbs as $lbl=>$val )					{						if( !$content[$grp][$lbl][$month->month] )						{							$content[$grp][$lbl][$month->month] = 0;						}						if( $month->month == 12 )						{							$content[$grp][$lbl][str_pad( ( $month->month+1 ), 2, 0, STR_PAD_LEFT )] = ( $var = CalcSumFromArray( $content[$grp][$lbl] ) );							$content[$grp][$lbl][str_pad( ( $month->month+2 ), 2, 0, STR_PAD_LEFT )] = round( CalcPercentageFromVars ( $var, $total ) ) . '%';						}					}				}			}		}		$content[0] = $head;	}		//die( print_r( $head ) . ' ..' );		//die( print_r( $year->months,1 ) . ' ..' );		//die( print_r( $sum,1 ) . ' ..' );		$str = '';	$str .= '<div class="budget"><table>';	if( $content )	{		foreach( $content as $key=>$group )		{			if( $key != '0' )			{				$str .= '<tr class="group">';				$str .= '<td><input name="Group" value="' . $key . '"/></td><td colspan="' . ( count( $content[0]['head'] ) - 1 ) . '"></td>';				$str .= '</tr>';			}			foreach( $group as $ky=>$label )			{				if( $label )				{					$str .= '<tr class="' . ( $key != '0' ? ( $ky == 'Sum' ? 'sum' : 'label' ) : 'head' ) . '">';					foreach( $label as $k=>$val )					{						if( $key != '0' && ( $ky == 'Sum' || $k > 12 ) )						{							$str .= '<td>' . $val . '</td>';						}						else if( $key != '0' )						{							$str .= '<td><input name="' . $key . '_' . '" value="' . $val . '"/></td>';						}						else						{							$str .= '<th>' . $val . '</th>';						}					}					$str .= '</tr>';				}			}		}	}	$str .= '</table></div>';}//die( print_r( $sum,1 ) . ' ..' );//die( print_r( $year,1 ) . ' ..' );//die( ' .. ' . print_r( $content,1 ) . ' .. ' );/*$str = '';$str .= '<table>';$str .= '<tr>';$str .= '<td></td>';$str .= '<th>Jan</th>';$str .= '<th>Feb</th>';$str .= '<th>Mar</th>';$str .= '<th>Apr</th>';$str .= '<th>May</th>';$str .= '<th>Jun</th>';$str .= '<th>Jul</th>';$str .= '<th>Aug</th>';$str .= '<th>Sep</th>';$str .= '<th>Okt</th>';$str .= '<th>Nov</th>';$str .= '<th>Dec</th>';$str .= '<th>Sum</th>';$str .= '<td>%</td>';$str .= '</tr>';$str .= '<tr>';$str .= '<th colspan="15"><input name="Group1" value="Group"/></th>';$str .= '</tr>';$str .= '<tr>';$str .= '<td><input name="Group1_Label1" value="Label"/></td>';$str .= '<td><input name="Group1_Label1_Col1_Row1" value="0"/></td>';$str .= '<td><input name="Group1_Label1_Col2_Row1" value="0"/></td>';$str .= '<td><input name="Group1_Label1_Col3_Row1" value="0"/></td>';$str .= '<td><input name="Group1_Label1_Col4_Row1" value="0"/></td>';$str .= '<td><input name="Group1_Label1_Col5_Row1" value="0"/></td>';$str .= '<td><input name="Group1_Label1_Col6_Row1" value="0"/></td>';$str .= '<td><input name="Group1_Label1_Col7_Row1" value="0"/></td>';$str .= '<td><input name="Group1_Label1_Col8_Row1" value="0"/></td>';$str .= '<td><input name="Group1_Label1_Col9_Row1" value="0"/></td>';$str .= '<td><input name="Group1_Label1_Col10_Row1" value="0"/></td>';$str .= '<td><input name="Group1_Label1_Col11_Row1" value="0"/></td>';$str .= '<td><input name="Group1_Label1_Col12_Row1" value="0"/></td>';$str .= '<td><input name="Group1_Label1_Col13_Row1" value="0"/></td>';$str .= '<td><input name="Group1_Label1_Col14_Row1" value="0%"/></td>';$str .= '</tr>';$str .= '<tr>';$str .= '<td><span>SUM</span></td>';$str .= '<td><span>0</span></td>';$str .= '<td><span>0</span></td>';$str .= '<td><span>0</span></td>';$str .= '<td><span>0</span></td>';$str .= '<td><span>0</span></td>';$str .= '<td><span>0</span></td>';$str .= '<td><span>0</span></td>';$str .= '<td><span>0</span></td>';$str .= '<td><span>0</span></td>';$str .= '<td><span>0</span></td>';$str .= '<td><span>0</span></td>';$str .= '<td><span>0</span></td>';$str .= '<td><span>0</span></td>';$str .= '<td><span>0%</span></td>';$str .= '</tr>';$str .= '</table>';*/?>