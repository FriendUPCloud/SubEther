<?php/*******************************************************************************
*   SubEther, The Decentralized Network.                                       *
*   Copyright (C) 2012 Friend Studios AS                                       *
*                                                                              *
*   This program is free software: you can redistribute it and/or modify       *
*   it under the terms of the GNU Affero General Public License as             *
*   published by the Free Software Foundation, either version 3 of the         *
*   License, or (at your option) any later version.                            *
*                                                                              *
*   This program is distributed in the hope that it will be useful,            *
*   but WITHOUT ANY WARRANTY; without even the implied warranty of             *
*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the              *
*   GNU Affero General Public License for more details.                        *
*                                                                              *
*   You should have received a copy of the GNU Affero General Public License   *
*   along with this program.  If not, see <https://www.gnu.org/licenses/>.     *
*******************************************************************************/function CalcSumFromArray ( $array ){	$sum = 0;	if( !is_array( $array ) ) return;	foreach( $array as $num )	{		if( is_numeric( $num ) )		{			$sum += $num;		}		else continue;			}	return $sum;}function CalcPercentageFromVars ( $var, $total ){	if( is_numeric( $var ) && is_numeric( $total ) )	{		return ( $var / $total * 100 );	}	return;}function CountCaseTasks ( $pid ){	if( !$pid ) return;		$ts = new dbObject( 'SBookCaseList' );        $ts->CaseID = $pid;        if( $ts = $ts->Find() )        {            $count = 0;            foreach( $ts as $t )            {            	if( $t->Progress == '100%' )            	{            	    $count++;            	}            }	                $c = new dbObject( 'SBookCaseList' );            if( $c->Load( $pid ) )            {            	$c->Progress = count( $ts ) > 0 ? ( ( $count / count( $ts ) * 100 ) . '%' ) : '0%';            	$c->Save();            }        }}function pdfSafe ( $in ){	$in = str_replace ( '&', '&amp;', $in );	return $in;}/*function is_datetime( $x, $f = false ){    if ( !strstr( $x, '-' ) && !strstr( $x, ':' ) && strlen( $x ) == 10 && strtotime( date( ( $f ? $f : 'Y-m-d H:i:s' ), $x ) ) == $x )	{		return true;	}		return false;}*/function renderAdminCalendar( $date ){	return renderAdminWebCalendar( $date );		switch( UserAgent() )	{		case 'web':			return renderAdminWebCalendar( $date );			break;				default:			return renderAdminMobileCalendar( $date );			break;	}}function renderAdminWebCalendar( $date, $events = false ){	$year = date( 'Y', strtotime( $date ) );	$month = date( 'm', strtotime( $date ) );	$day = date( 'd', strtotime( $date ) );	$week = date( 'W', strtotime( $date ) );		$nstr = '<tr class="nv"><th colspan="8">';	$nstr .= '<div class="nav">';	$nstr .= '<span class="Left"><a href="javascript:void(0)" class="prevYear" title="' . i18n ( 'i18n_Previous_Year' ) . '" onclick="RefreshAdminCalendar(\'' . mktime( 0, 0, 0, date( 'm', strtotime( $date ) ), date( 'd', strtotime( $date ) ), date( 'Y', strtotime( $date ) )-1 ) . '\',this)"> << </a>';	$nstr .= '<a href="javascript:void(0)" class="prevMonth" title="' . i18n ( 'i18n_Previous_Month' ) . '" onclick="RefreshAdminCalendar(\'' . mktime( 0, 0, 0, date( 'm', strtotime( $date ) )-1, date( 'd', strtotime( $date ) ), date( 'Y', strtotime( $date ) ) ) . '\',this)"> < </a></span>';	$nstr .= '<span class="Center"><a href="javascript:void(0)" title="' . i18n ( 'i18n_Todays_Date' ) . '" onclick="RefreshAdminCalendar(\'' . mktime( 0, 0, 0, date( 'm' ), date( 'd' ), date( 'Y' ) ) . '\',this)">' . i18n ( 'i18n_' . date ( 'F', strtotime ( $year . '-' . $month ) ) ) . ', ' . $year . '</a></span>';	$nstr .= '<span class="Right"><a href="javascript:void(0)" class="nextMonth" title="' . i18n ( 'i18n_Next_Month' ) . '" onclick="RefreshAdminCalendar(\'' . mktime( 0, 0, 0, date( 'm', strtotime( $date ) )+1, date( 'd', strtotime( $date ) ), date( 'Y', strtotime( $date ) ) ) . '\',this)"> > </a>';	$nstr .= '<a href="javascript:void(0)" class="nextYear" title="' . i18n ( 'i18n_Next_Year' ) . '" onclick="RefreshAdminCalendar(\'' . mktime( 0, 0, 0, date( 'm', strtotime( $date ) ), date( 'd', strtotime( $date ) ), date( 'Y', strtotime( $date ) )+1 ) . '\',this)"> >> </a> </span>';	$nstr .= '</div>';	$nstr .= '</th></tr>';		$o = new CalendarMonth( $date = ( $year . '-' . $month . '-' . $day ) );		if ( count ( $events ) && is_array ( $events ) )	{		$o->ImportEvents ( $events, 'DateStart', 'DateEnd' );	}		$i = 0; $sw = 2; $s = 0; $y = 0; $evt = '';	$str = '<table class="CalendarMonth"><tbody>' . $nstr;	foreach( $o->weeks as $key=>$w )	{			$x = 0;		$ch = 1 + $s;		$sw = ( $sw == '1' ? '2' : '1' );		$hstr = '<tr class="hd">';		$dstr = '<tr class="sw' . $sw . '">';		foreach( $w->days as $k=>$d )		{			$ch = ( $ch + 1 ) % 2; $evnt = '';						$ct = strtotime( $d->date );						$cw = new DateTime();			$cw->setISODate( date( 'Y', $ct ), date( 'W', $ct ), 1 );						if( $x == 0 )			{					$hstr .= '<th><div class="Week"><div class="heading">' . i18n ( 'i18n_s_Week' ) . '</div></div></th>';				$dstr .= '<td><div class="Week"><div class="number">' . $d->week . '</div></div></td>';			}						if( $i == 0 )			{				$hstr .= '<th><div class="' . $d->name . '"><div class="number">' . i18n ( 'i18n_s_' . $d->name ) . '</div></div></th>';			}						if( date( 'Y-m-d', strtotime( $d->date ) ) == $date ) $sel = ' Selected'; else $sel = '';						$slot = ( $d->events && $d->events[0]->Reserved ? ' Reserved' : false );						$dstr .= ( $d->month == $o->month ? '<td class="ch' . ( $ch + 1 ) . '"><div class="' . $d->name . ( $slot ? $slot : ' Available' ) . $sel . '" ' . ( !$slot ? 'onclick="SetAdminDate(\'' . $ct . '\',\'' . i18n('i18n_day_'.date('d',$ct)) . '\',\'' . ( i18n( 'i18n_s_' . date( 'D', $ct ) ) . date( ', d.m.Y', $ct ) ) . '\',this)"' : '' ) . '><div class="events">' . $evnt . '</div><div class="number">' . $d->day . '</div></div></td>' : '<td class="ch' . ( $ch + 1 ) . '"><div class="Space" ' . ( !$slot ? 'onclick="SetAdminDate(\'' . $ct . '\',\'' . i18n('i18n_day_'.date('d',$ct)) . '\',\'' . ( i18n( 'i18n_s_' . date( 'D', $ct ) ) . date( ', d.m.Y', $ct ) ) . '\',this)"' : '' ) . '><div class="number">' . $d->day . '</div></div></td>' );						$x++;		}		if( $i == 0 && $hstr ) $str .= $hstr . '</tr>';		if( $dstr ) $str .= $dstr . '</tr>';		$s = ( $s + 1 ) % 2;		$i++; $y++;	}	$str .= '</tbody></table>';	return $str;}function renderAdminMobileCalendar( $date, $events = false ){	$year = date( 'Y', strtotime( $date ) );	$month = date( 'm', strtotime( $date ) );	$day = date( 'd', strtotime( $date ) );	$week = date( 'W', strtotime( $date ) );		$nstr .= '<div class="nav"><div><div><div>';	$nstr .= '<span class="Left"><a href="javascript:void(0)" class="prevYear" title="' . i18n ( 'i18n_Previous_Year' ) . '" onclick="RefreshAdminCalendar(\'' . mktime( 0, 0, 0, date( 'm', strtotime( $date ) ), date( 'd', strtotime( $date ) ), date( 'Y', strtotime( $date ) )-1 ) . '\',this)"> << </a>';	$nstr .= '<a href="javascript:void(0)" class="prevMonth" title="' . i18n ( 'i18n_Previous_Month' ) . '" onclick="RefreshAdminCalendar(\'' . mktime( 0, 0, 0, date( 'm', strtotime( $date ) )-1, date( 'd', strtotime( $date ) ), date( 'Y', strtotime( $date ) ) ) . '\',this)"> < </a></span>';	$nstr .= '<span class="Center"><a href="javascript:void(0)" title="' . i18n ( 'i18n_Todays_Date' ) . '" onclick="RefreshAdminCalendar(\'' . mktime( 0, 0, 0, date( 'm' ), date( 'd' ), date( 'Y' ) ) . '\',this)">' . i18n ( 'i18n_' . date ( 'F', strtotime ( $year . '-' . $month ) ) ) . ', ' . $year . '</a></span>';	$nstr .= '<span class="Right"><a href="javascript:void(0)" class="nextMonth" title="' . i18n ( 'i18n_Next_Month' ) . '" onclick="RefreshAdminCalendar(\'' . mktime( 0, 0, 0, date( 'm', strtotime( $date ) )+1, date( 'd', strtotime( $date ) ), date( 'Y', strtotime( $date ) ) ) . '\',this)"> > </a>';	$nstr .= '<a href="javascript:void(0)" class="nextYear" title="' . i18n ( 'i18n_Next_Year' ) . '" onclick="RefreshAdminCalendar(\'' . mktime( 0, 0, 0, date( 'm', strtotime( $date ) ), date( 'd', strtotime( $date ) ), date( 'Y', strtotime( $date ) )+1 ) . '\',this)"> >> </a> </span>';	$nstr .= '</div></div></div></div>';		$o = new CalendarMonth( $date = ( $year . '-' . $month . '-' . $day ) );		if ( count ( $events ) && is_array ( $events ) )	{		$o->ImportEvents ( $events, 'DateStart', 'DateEnd' );	}		$i = 0; $sw = 2; $s = 0; $y = 0; $evt = '';	$str = '<div class="CalendarMonth mobile">' . $nstr . '<div class="datelist"><div><div>';	foreach( $o->weeks as $key=>$w )	{			$x = 0;		$ch = 1 + $s;		$sw = ( $sw == 1 ? 2 : 1 );				foreach( $w->days as $k=>$d )		{			$ch = ( $ch + 1 ) % 2; $evnt = '';						$ct = strtotime( $d->date );						$cw = new DateTime();			$cw->setISODate( date( 'Y', $ct ), date( 'W', $ct ), 1 );						if( date( 'Y-m-d', strtotime( $d->date ) ) == $date ) $sel = ' Selected'; else $sel = '';						$slot = ( $d->events && $d->events[0]->Reserved ? ' Reserved' : false );						$dstr .= ( $d->month == $o->month ? '<div class="' . $d->name . ( $slot ? $slot : ' Available' ) . $sel . '" ' . ( !$slot ? 'onclick="SetAdminDate(\'' . $ct . '\',\'' . i18n('i18n_day_'.date('d',$ct)) . '\',\'' . ( i18n( 'i18n_s_' . date( 'D', $ct ) ) . date( ', d.m.Y', $ct ) ) . '\',this)"' : '' ) . '><div class="number">' . date( 'D, d.m.Y', $ct ) . '</div></div>' : '<div class="Space" ' . ( !$slot ? 'onclick="SetAdminDate(\'' . $ct . '\',\'' . i18n('i18n_day_'.date('d',$ct)) . '\',\'' . ( i18n( 'i18n_s_' . date( 'D', $ct ) ) . date( ', d.m.Y', $ct ) ) . '\',this)"' : '' ) . '><div class="number">' . ( i18n( 'i18n_s_' . date( 'D', $ct ) ) . date( ', d.m.Y', $ct ) ) . '</div></div>' );						$x++;		}		$s = ( $s + 1 ) % 2;		$i++; $y++;	}	if( $dstr ) $str .= $dstr;	$str .= '</div></div></div></div>';	return $str;}?>